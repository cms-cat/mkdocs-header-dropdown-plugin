<!--
  Header Dropdown - Rendered inline and injected via JavaScript
-->
<div id="header-dropdown-template" style="display: none;">
{% if config.extra.header_dropdowns %}
  {% for dropdown in config.extra.header_dropdowns %}
    <div class="md-header__option" style="margin-right: 0.1rem;">
      <div class="md-header__dropdown"
           style="position: relative; display: inline-block;"
           onmouseenter="showHeaderDropdown(this)"
           onmouseleave="hideHeaderDropdown(this)">
        <button class="md-header__button"
                style="padding: 0.4rem; display: flex; align-items: center; gap: 0.3rem"
                onclick="toggleHeaderDropdown(event)">
          {% if dropdown.icon %}
            <img src="{{ dropdown.icon }}" alt="{{ dropdown.title }}" style="width: 35px; height: 35px;" />
          {% endif %}
          <span style="font-size: 0.7rem;">{{ dropdown.title }}</span>
        </button>
        <div class="md-header__dropdown-content"
             style="display: none; position: absolute; left: 0; top: 100%; background: var(--md-default-bg-color); border: 1px solid var(--md-default-fg-color--lightest); border-radius: 0.1rem; box-shadow: var(--md-shadow-z2); min-width: 200px; z-index: 1000;">
          {% for link in dropdown.links %}
            <a href="{{ link.url }}"
               {% if link.target %}target="{{ link.target }}"{% endif %}
               style="display: block; padding: 0.5rem 1rem; color: var(--md-default-fg-color); text-decoration: none; font-size: 0.7rem"
               onmouseover="this.style.backgroundColor='var(--md-default-fg-color--lightest)'"
               onmouseout="this.style.backgroundColor='transparent'">
              {{ link.text }}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}
</div>

<script>
  // Inject dropdown into header after page load
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-dropdown-template');
    const search = document.querySelector('.md-search');

    if (template && search && !document.querySelector('.md-header__dropdown')) {
      // Clone the template content and insert after search
      const content = template.innerHTML;
      search.insertAdjacentHTML('afterend', content);
    }
  });

  // Dropdown interaction functions
  if (typeof toggleHeaderDropdown === 'undefined') {
    function toggleHeaderDropdown(event) {
      event.stopPropagation();
      const dropdown = event.target.closest('.md-header__dropdown');
      const content = dropdown.querySelector('.md-header__dropdown-content');
      const isVisible = content.style.display === 'block';

      document.querySelectorAll('.md-header__dropdown-content').forEach(el => {
        el.style.display = 'none';
      });

      content.style.display = isVisible ? 'none' : 'block';
    }

    function showHeaderDropdown(dropdown) {
      const content = dropdown.querySelector('.md-header__dropdown-content');
      content.style.display = 'block';
    }

    function hideHeaderDropdown(dropdown) {
      setTimeout(() => {
        const content = dropdown.querySelector('.md-header__dropdown-content');
        if (!dropdown.matches(':hover')) {
          content.style.display = 'none';
        }
      }, 100);
    }

    document.addEventListener('click', function() {
      document.querySelectorAll('.md-header__dropdown-content').forEach(el => {
        el.style.display = 'none';
      });
    });
  }
</script>
